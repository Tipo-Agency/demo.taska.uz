# Техническое задание: Модуль финансов (Finance Module)

## 1. Общая информация

### 1.1. Назначение
Модуль финансов предназначен для управления финансовым планированием, заявками на покупку, отделами и категориями расходов.

### 1.2. Компоненты модуля
- **Отделы** - Управление отделами компании
- **Категории расходов** - Категории для планирования расходов
- **Финансовый план** - Планирование доходов и расходов
- **Заявки на покупку** - Заявки на закупку товаров/услуг
- **Документы финансового плана** - Документы по финансовому планированию

## 2. Отделы (Departments)

### 2.1. Создание отдела

#### 2.1.1. Обязательные поля
- **name** (string) - Название отдела

#### 2.1.2. Опциональные поля
- **description** (string) - Описание отдела
- **headId** (string) - ID руководителя отдела

### 2.2. Управление отделами
- Просмотр списка отделов
- Редактирование отдела
- Мягкое удаление (архив)
- Восстановление из архива

## 3. Категории расходов (Finance Categories)

### 3.1. Создание категории

#### 3.1.1. Обязательные поля
- **name** (string) - Название категории
- **type** (string) - Тип: 'fixed' (фиксированная) или 'percent' (процентная)

#### 3.1.2. Опциональные поля
- **color** (string) - Цвет для отображения

### 3.2. Типы категорий
- **fixed** - Фиксированная сумма
- **percent** - Процент от дохода

## 4. Финансовый план (Finance Plan)

### 4.1. Создание финансового плана

#### 4.1.1. Обязательные поля
- **period** (string) - Период: 'week' или 'month'
- **salesPlan** (number) - План продаж
- **currentIncome** (number) - Текущий доход

### 4.2. Управление планом
- Обновление плана продаж
- Отслеживание текущего дохода
- Сравнение плана и факта

## 5. Заявки на покупку (Purchase Requests)

### 5.1. Создание заявки

#### 5.1.1. Обязательные поля
- **requesterId** (string) - ID запрашивающего
- **departmentId** (string) - ID отдела
- **categoryId** (string) - ID категории финансов
- **amount** (number) - Сумма заявки
- **description** (string) - Описание заявки
- **date** (string) - Дата заявки (YYYY-MM-DD)

#### 5.1.2. Статусы заявки
- **pending** - На рассмотрении
- **approved** - Одобрена
- **rejected** - Отклонена
- **deferred** - Отложена

### 5.2. Процесс согласования
- Создание заявки сотрудником
- Рассмотрение заявки руководителем/администратором
- Одобрение или отклонение
- Уведомления о статусе заявки

### 5.3. Интеграция с Tasks модулем
- Заявка на покупку создается как задача (`entityType: 'purchase_request'`)
- Связь с отделом (`departmentId`)
- Связь с категорией (`categoryId`)
- Сумма заявки (`amount`)

## 6. Документы финансового плана (Financial Plan Documents)

### 6.1. Создание документа

#### 6.1.1. Обязательные поля
- **departmentId** (string) - ID отдела
- **period** (string) - Период (YYYY-MM формат месяца)
- **income** (number) - Доход
- **expenses** (Record<string, number>) - Расходы по статьям: { categoryId: amount }
- **status** (string) - Статус: 'created' | 'conducted' | 'approved'

#### 6.1.2. Статусы документа
- **created** - Создан
- **conducted** - Проведен
- **approved** - Утвержден

### 6.2. Управление документами
- Создание документа финансового плана
- Заполнение доходов и расходов
- Проведение документа
- Утверждение документа администратором

## 7. Интеграции

### 7.1. Интеграция с Tasks модулем
- Заявки на покупку отображаются как задачи
- Автоматическое создание задачи при создании заявки

### 7.2. Интеграция с HR модулем
- Связь с отделами
- Связь с сотрудниками (через отделы)

### 7.3. Интеграция с Notifications модулем
- Уведомления о новых заявках
- Уведомления об изменении статуса заявки
- Уведомления о необходимости согласования

## 8. Технические детали

### 8.1. Компоненты
- `FinanceModule` - Основной компонент модуля
- `PurchaseRequestModal` - Модальное окно создания/редактирования заявки
- `FinancialPlanView` - Представление финансового плана
- `DepartmentsView` - Представление отделов
- `FinanceCategoriesView` - Представление категорий

### 8.2. API Endpoints
- `GET /api/departments` - Получить все отделы
- `POST /api/departments` - Создать отдел
- `PUT /api/departments/:id` - Обновить отдел
- `DELETE /api/departments/:id` - Удалить отдел
- `GET /api/finance/categories` - Получить все категории
- `POST /api/finance/categories` - Создать категорию
- `GET /api/finance/plan` - Получить финансовый план
- `PUT /api/finance/plan` - Обновить финансовый план

### 8.3. Коллекции Firestore
- `departments` - Отделы
- `financeCategories` - Категории расходов
- `financePlan` - Финансовый план
- `purchaseRequests` - Заявки на покупку
- `financialPlanDocuments` - Документы финансового плана
